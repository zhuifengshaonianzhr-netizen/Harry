<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½äº”å­æ£‹æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        /* çŸ³å¤´å‰ªå­å¸ƒç•Œé¢ */
        .rps-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .rps-title {
            font-size: 1.8em;
            color: white;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .rps-choices {
            display: flex;
            gap: 20px;
        }

        .rps-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .rps-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* çŸ³å¤´å‰ªå­å¸ƒç»“æœæ˜¾ç¤º */
        .rps-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            color: white;
            font-size: 1.5em;
        }

        .result-text {
            font-size: 2em;
            font-weight: bold;
            margin-top: 10px;
            color: #ffeb3b;
        }

        /* æ¸¸æˆç•Œé¢ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .current-player {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
        }

        .game-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* æŠ€èƒ½æ  */
        .skills-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .skill-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }

        .skill-btn {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .skill-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .skill-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-icon {
            font-size: 2em;
        }

        .skill-name {
            font-size: 0.8em;
            margin-top: 5px;
        }

        .skill-cooldown {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff5722;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            font-weight: bold;
        }

        .skill-desc {
            color: white;
            font-size: 0.9em;
            text-align: center;
            margin-top: 10px;
        }

        /* æ£‹ç›˜ */
        .board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #d8a767;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .board-row {
            display: flex;
        }

        .board-cell {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        .board-cell::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 1px;
            background: #000;
            transform: translateY(50%);
        }

        .board-cell::after {
            content: '';
            position: absolute;
            width: 1px;
            height: 100%;
            background: #000;
            transform: translateX(50%);
        }

        /* æ£‹å­ */
        .piece {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            z-index: 2;
            transition: all 0.2s ease;
        }

        .black-piece {
            background: #000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .white-piece {
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .last-move {
            box-shadow: 0 0 0 3px #ff5722;
        }

        /* æ¸¸æˆç»“æŸ */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .winner-text {
            color: white;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 30px;
        }

        /* éšè—å…ƒç´  */
        .hidden {
            display: none;
        }

        /* æ¸¸æˆè§„åˆ™ */
        .game-rules {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .rules-title {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            display: block;
            margin-bottom: 15px;
        }

        .rule-item {
            color: white;
            font-size: 1em;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æŠ€èƒ½äº”å­æ£‹æ¼”ç¤º</h1>
        
        <!-- çŸ³å¤´å‰ªå­å¸ƒç•Œé¢ -->
        <div id="rpsContainer" class="rps-container">
            <div class="rps-title">çŸ³å¤´å‰ªå­å¸ƒå†³å®šå…ˆæ‰‹</div>
            <div class="rps-choices">
                <button class="rps-btn" data-choice="çŸ³å¤´">çŸ³å¤´</button>
                <button class="rps-btn" data-choice="å‰ªåˆ€">å‰ªåˆ€</button>
                <button class="rps-btn" data-choice="å¸ƒ">å¸ƒ</button>
            </div>
            
            <!-- AIå¯¹æˆ˜é€‰é¡¹ -->
            <div style="margin-top: 20px; color: white; display: none;">
                <label>
                    <input type="checkbox" id="aiToggle" style="margin-right: 10px;" checked>
                    å¯ç”¨AIå¯¹æˆ˜
                </label>
                <div id="aiDifficulty" style="margin-top: 10px;">
                    <label>AIéš¾åº¦: </label>
                    <select id="difficultySelect" style="margin-left: 10px; padding: 5px; border-radius: 5px;">
                        <option value="0">ç®€å•</option>
                        <option value="1" selected>ä¸­ç­‰</option>
                        <option value="2">å›°éš¾</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- çŸ³å¤´å‰ªå­å¸ƒç»“æœæ˜¾ç¤º -->
        <div id="rpsResult" class="rps-result hidden">
            <div>ä½ å‡º: <span id="playerChoice"></span></div>
            <div>ç”µè„‘å‡º: <span id="computerChoice"></span></div>
            <div class="result-text" id="resultText"></div>
        </div>
        
        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameBoard" class="hidden">
            <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
            <div class="game-header">
                <div class="current-player">å½“å‰: <span id="currentPlayerText">é»‘å­</span></div>
                <button class="game-btn" id="undoBtn">æ‚”æ£‹</button>
                <button class="game-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
            </div>
            
            <!-- æŠ€èƒ½æ  -->
            <div class="skills-container">
                <div class="skill-item">
                    <button class="skill-btn" id="skill0" data-index="0">
                        <div class="skill-icon">ğŸŒªï¸</div>
                        <div class="skill-name">é£æ²™èµ°çŸ³</div>
                        <div class="skill-cooldown hidden" id="cooldown0">3</div>
                    </button>
                    <div class="skill-desc">ç§»é™¤å¯¹æ–¹1é¢—æ£‹å­ (å†·å´: 3å›åˆ)</div>
                </div>
                
                <div class="skill-item">
                    <button class="skill-btn" id="skill1" data-index="1">
                        <div class="skill-icon">ğŸ’¥</div>
                        <div class="skill-name">åŠ›æ‹”å±±å…®</div>
                        <div class="skill-cooldown hidden" id="cooldown1">5</div>
                    </button>
                    <div class="skill-desc">æ¸…é™¤ä¸­å¿ƒåŒºåŸŸæ£‹å­ (å†·å´: 5å›åˆ)</div>
                </div>
                
                <div class="skill-item">
                    <button class="skill-btn" id="skill2" data-index="2">
                        <div class="skill-icon">ğŸ”„</div>
                        <div class="skill-name">ä¸œå±±å†èµ·</div>
                        <div class="skill-cooldown hidden" id="cooldown2">1</div>
                    </button>
                    <div class="skill-desc">æ¢å¤è¢«æ¸…é™¤çš„æ£‹å­ (å†·å´: 1å›åˆ)</div>
                </div>
            </div>
            
            <!-- æ£‹ç›˜ -->
            <div class="board-container">
                <div id="board"></div>
            </div>
            
            <!-- æ¸¸æˆç»“æŸæç¤º -->
            <div id="gameOver" class="game-over hidden">
                <div class="winner-text" id="winnerText">é»‘å­è·èƒœ!</div>
                <button class="game-btn" id="playAgainBtn">å†æ¥ä¸€å±€</button>
                <button class="game-btn" id="homeBtn">è¿”å›é¦–é¡µ</button>
            </div>
        </div>
        
        <!-- æ¸¸æˆè§„åˆ™ -->
        <div class="game-rules">
            <div class="rules-title">æ¸¸æˆè§„åˆ™ï¼š</div>
            <div class="rule-item">1. 15Ã—15æ ‡å‡†æ£‹ç›˜ï¼Œé€šè¿‡çŸ³å¤´å‰ªå­å¸ƒå†³å®šè°å…ˆå¼€å§‹</div>
            <div class="rule-item">2. åŒæ–¹äº¤æ›¿è½å­ï¼Œç‡å…ˆåœ¨æ¨ªã€ç«–ã€æ–œå‘å½¢æˆè¿ç»­äº”å­è¿çº¿è€…è·èƒœ</div>
            <div class="rule-item">3. ä¸‰ç§ç‰¹è‰²æŠ€èƒ½ï¼š</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ é£æ²™èµ°çŸ³ï¼šç§»é™¤å¯¹æ–¹1é¢—æ£‹å­ï¼ˆå†·å´3å›åˆï¼‰</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ åŠ›æ‹”å±±å…®ï¼šæ¸…é™¤æ£‹ç›˜ä¸­å¤®åŒºåŸŸçš„æ‰€æœ‰æ£‹å­ï¼ˆå†·å´5å›åˆï¼‰</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ ä¸œå±±å†èµ·ï¼šå›å¤è¢«åŠ›æ‹”å±±å…®æ¸…é™¤çš„æ£‹å­ï¼ˆå†·å´1å›åˆï¼‰</div>
            <div class="rule-item">4. æ“ä½œè¯´æ˜ï¼š</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ ç‚¹å‡»æ£‹ç›˜è½å­</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ ç‚¹å‡»æŠ€èƒ½å›¾æ ‡ä½¿ç”¨æŠ€èƒ½</div>
            <div class="rule-item">&nbsp;&nbsp;â€¢ æ‚”æ£‹åŠŸèƒ½å¯æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ</div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            board: [],
            currentPlayer: 0, // 0: é»‘å­, 1: ç™½å­
            gameStatus: 'waiting', // waiting, playing, ended
            winner: null,
            lastMove: null,
            moveHistory: [],
            removedPieces: [],
            skills: [
                { name: 'é£æ²™èµ°çŸ³', cooldown: 3, currentCooldown: 0 },
                { name: 'åŠ›æ‹”å±±å…®', cooldown: 5, currentCooldown: 0 },
                { name: 'ä¸œå±±å†èµ·', cooldown: 1, currentCooldown: 0 }
            ],
            // AIç›¸å…³çŠ¶æ€
            aiEnabled: true, // æ˜¯å¦å¯ç”¨AI
            aiPlayer: 1, // AIç©å®¶(é»˜è®¤ç™½å­)
            aiDifficulty: 2 // AIéš¾åº¦çº§åˆ« (0:ç®€å•, 1:ä¸­ç­‰, 2:å›°éš¾)
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–æ£‹ç›˜
            gameState.board = [];
            for (let i = 0; i < 15; i++) {
                const row = [];
                for (let j = 0; j < 15; j++) {
                    row.push(null);
                }
                gameState.board.push(row);
            }
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.currentPlayer = 0;
            gameState.gameStatus = 'waiting';
            gameState.winner = null;
            gameState.lastMove = null;
            gameState.moveHistory = [];
            gameState.removedPieces = [];
            gameState.skills = [
                { name: 'é£æ²™èµ°çŸ³', cooldown: 3, currentCooldown: 0 },
                { name: 'åŠ›æ‹”å±±å…®', cooldown: 5, currentCooldown: 0 },
                { name: 'ä¸œå±±å†èµ·', cooldown: 1, currentCooldown: 0 }
            ];
            
            // æ›´æ–°UI
            renderBoard();
            updateUI();
            
            // æ˜¾ç¤ºçŸ³å¤´å‰ªå­å¸ƒç•Œé¢
            document.getElementById('rpsContainer').classList.remove('hidden');
            document.getElementById('rpsResult').classList.add('hidden');
            document.getElementById('gameBoard').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
        }

        // è¯„ä¼°æ£‹ç›˜ä½ç½®çš„ä»·å€¼
        function evaluatePosition(board, player) {
            let score = 0;
            const directions = [
                [0, 1],  // æ°´å¹³
                [1, 0],  // å‚ç›´
                [1, 1],  // å¯¹è§’çº¿
                [1, -1]  // åå¯¹è§’çº¿
            ];
            
            // è¯„ä¼°è¿ç»­å­çš„æ•°é‡
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    if (board[i][j] !== null) {
                        const piecePlayer = board[i][j];
                        const multiplier = piecePlayer === player ? 1 : -1;
                        
                        for (let [dx, dy] of directions) {
                            let count = 1;
                            
                            // æ­£æ–¹å‘æ£€æŸ¥
                            for (let k = 1; k <= 4; k++) {
                                const newRow = i + dx * k;
                                const newCol = j + dy * k;
                                if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                                    board[newRow][newCol] === piecePlayer) {
                                    count++;
                                } else {
                                    break;
                                }
                            }
                            
                            // åæ–¹å‘æ£€æŸ¥
                            for (let k = 1; k <= 4; k++) {
                                const newRow = i - dx * k;
                                const newCol = j - dy * k;
                                if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                                    board[newRow][newCol] === piecePlayer) {
                                    count++;
                                } else {
                                    break;
                                }
                            }
                            
                            // æ ¹æ®è¿ç»­å­æ•°é‡è¯„åˆ†
                            if (count >= 5) {
                                score += multiplier * 10000;
                            } else if (count === 4) {
                                score += multiplier * 1000;
                            } else if (count === 3) {
                                score += multiplier * 100;
                            } else if (count === 2) {
                                score += multiplier * 10;
                            }
                        }
                    }
                }
            }
            
            return score;
        }

        // è®¡ç®—æœ€ä½³è½å­ä½ç½®
        function calculateBestMove() {
            const player = gameState.currentPlayer;
            let bestScore = -Infinity;
            let bestMove = null;
            
            // ç®€å•éš¾åº¦ï¼šéšæœºé€‰æ‹©
            if (gameState.aiDifficulty === 0) {
                const emptyCells = [];
                for (let i = 0; i < 15; i++) {
                    for (let j = 0; j < 15; j++) {
                        if (gameState.board[i][j] === null) {
                            emptyCells.push({ row: i, col: j });
                        }
                    }
                }
                
                if (emptyCells.length > 0) {
                    const randomIndex = Math.floor(Math.random() * emptyCells.length);
                    return emptyCells[randomIndex];
                }
                return null;
            }
            
            // ä¸­ç­‰å’Œå›°éš¾éš¾åº¦ï¼šè¯„ä¼°æ¯ä¸ªå¯èƒ½çš„ä½ç½®
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    if (gameState.board[i][j] === null) {
                        // ä¸´æ—¶è½å­
                        gameState.board[i][j] = player;
                        
                        // è¯„ä¼°ä½ç½®
                        const score = evaluatePosition(gameState.board, player);
                        
                        // æ’¤é”€ä¸´æ—¶è½å­
                        gameState.board[i][j] = null;
                        
                        // æ›´æ–°æœ€ä½³ä½ç½®
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = { row: i, col: j };
                        }
                    }
                }
            }
            
            return bestMove;
        }

        // AIä½¿ç”¨æŠ€èƒ½ç­–ç•¥
        function aiUseSkill() {
            // ç®€å•éš¾åº¦ï¼šä¸ä½¿ç”¨æŠ€èƒ½
            if (gameState.aiDifficulty === 0) {
                return false;
            }
            
            // ä¸­ç­‰éš¾åº¦ï¼šéšæœºä½¿ç”¨æŠ€èƒ½
            if (gameState.aiDifficulty === 1) {
                if (Math.random() < 0.3) { // 30%æ¦‚ç‡ä½¿ç”¨æŠ€èƒ½
                    const availableSkills = [];
                    for (let i = 0; i < 3; i++) {
                        if (gameState.skills[i].currentCooldown === 0) {
                            availableSkills.push(i);
                        }
                    }
                    
                    if (availableSkills.length > 0) {
                        const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                        useSkill(randomSkill);
                        return true;
                    }
                }
                return false;
            }
            
            // å›°éš¾éš¾åº¦ï¼šæ™ºèƒ½ä½¿ç”¨æŠ€èƒ½
            if (gameState.aiDifficulty === 2) {
                // æ£€æŸ¥æ˜¯å¦èƒ½è·èƒœ
                for (let i = 0; i < 15; i++) {
                    for (let j = 0; j < 15; j++) {
                        if (gameState.board[i][j] === null) {
                            // ä¸´æ—¶è½å­
                            gameState.board[i][j] = gameState.currentPlayer;
                            
                            // æ£€æŸ¥æ˜¯å¦è·èƒœ
                            if (checkWin(i, j, gameState.currentPlayer)) {
                                // æ’¤é”€ä¸´æ—¶è½å­
                                gameState.board[i][j] = null;
                                
                                // å¦‚æœèƒ½è·èƒœï¼Œä¸ä½¿ç”¨æŠ€èƒ½ï¼Œç›´æ¥è½å­
                                return false;
                            }
                            
                            // æ’¤é”€ä¸´æ—¶è½å­
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // éšæœºä½¿ç”¨æŠ€èƒ½
                if (Math.random() < 0.5) { // 50%æ¦‚ç‡ä½¿ç”¨æŠ€èƒ½
                    const availableSkills = [];
                    for (let i = 0; i < 3; i++) {
                        if (gameState.skills[i].currentCooldown === 0) {
                            availableSkills.push(i);
                        }
                    }
                    
                    if (availableSkills.length > 0) {
                        const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                        useSkill(randomSkill);
                        return true;
                    }
                }
                return false;
            }
            
            // è¶…çº§å›°éš¾éš¾åº¦ï¼šæ›´åŠ æ¿€è¿›å’Œæ™ºèƒ½åœ°ä½¿ç”¨æŠ€èƒ½
            if (gameState.aiDifficulty === 3) {
                // æ£€æŸ¥æ˜¯å¦èƒ½è·èƒœ
                for (let i = 0; i < 15; i++) {
                    for (let j = 0; j < 15; j++) {
                        if (gameState.board[i][j] === null) {
                            // ä¸´æ—¶è½å­
                            gameState.board[i][j] = gameState.currentPlayer;
                            
                            // æ£€æŸ¥æ˜¯å¦è·èƒœ
                            if (checkWin(i, j, gameState.currentPlayer)) {
                                // æ’¤é”€ä¸´æ—¶è½å­
                                gameState.board[i][j] = null;
                                
                                // å¦‚æœèƒ½è·èƒœï¼Œä¸ä½¿ç”¨æŠ€èƒ½ï¼Œç›´æ¥è½å­
                                return false;
                            }
                            
                            // æ’¤é”€ä¸´æ—¶è½å­
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // æ£€æŸ¥å¯¹æ‰‹æ˜¯å¦å³å°†è·èƒœï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨æŠ€èƒ½é˜»æ­¢
                const opponent = 1 - gameState.currentPlayer;
                for (let i = 0; i < 15; i++) {
                    for (let j = 0; j < 15; j++) {
                        if (gameState.board[i][j] === null) {
                            // ä¸´æ—¶è½å­ï¼ˆå¯¹æ‰‹ï¼‰
                            gameState.board[i][j] = opponent;
                            
                            // æ£€æŸ¥å¯¹æ‰‹æ˜¯å¦è·èƒœ
                            if (checkWin(i, j, opponent)) {
                                // æ’¤é”€ä¸´æ—¶è½å­
                                gameState.board[i][j] = null;
                                
                                // ä½¿ç”¨é£æ²™èµ°çŸ³æŠ€èƒ½ç§»é™¤å¯¹æ‰‹çš„æ£‹å­
                                if (gameState.skills[0].currentCooldown === 0) {
                                    useSkill(0);
                                    return true;
                                }
                                
                                // å¦‚æœé£æ²™èµ°çŸ³ä¸å¯ç”¨ï¼Œå°è¯•å…¶ä»–æŠ€èƒ½
                                if (gameState.skills[1].currentCooldown === 0) {
                                    useSkill(1);
                                    return true;
                                }
                            }
                            
                            // æ’¤é”€ä¸´æ—¶è½å­
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // æ›´é«˜æ¦‚ç‡ä½¿ç”¨æŠ€èƒ½
                if (Math.random() < 0.7) { // 70%æ¦‚ç‡ä½¿ç”¨æŠ€èƒ½
                    const availableSkills = [];
                    for (let i = 0; i < 3; i++) {
                        if (gameState.skills[i].currentCooldown === 0) {
                            availableSkills.push(i);
                        }
                    }
                    
                    if (availableSkills.length > 0) {
                        // ä¼˜å…ˆä½¿ç”¨æ›´å¼ºå¤§çš„æŠ€èƒ½
                        if (availableSkills.includes(1)) { // åŠ›æ‹”å±±å…®
                            useSkill(1);
                            return true;
                        } else if (availableSkills.includes(0)) { // é£æ²™èµ°çŸ³
                            useSkill(0);
                            return true;
                        } else if (availableSkills.includes(2)) { // ä¸œå±±å†èµ·
                            useSkill(2);
                            return true;
                        }
                        
                        // å¦‚æœæ²¡æœ‰ç‰¹åˆ«ä¼˜å…ˆçš„æŠ€èƒ½ï¼Œéšæœºé€‰æ‹©
                        const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                        useSkill(randomSkill);
                        return true;
                    }
                }
            }
            
            return false;
        }

        // AIæ‰§è¡Œç§»åŠ¨
        function makeAIMove() {
            if (gameState.gameStatus !== 'playing') return;
            
            // å…ˆå°è¯•ä½¿ç”¨æŠ€èƒ½
            if (aiUseSkill()) {
                // æŠ€èƒ½ä½¿ç”¨åæ›´æ–°UI
                renderBoard();
                updateUI();
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (gameState.gameStatus === 'ended') return;
                
                // åˆ‡æ¢ç©å®¶
                gameState.currentPlayer = 1 - gameState.currentPlayer;
                
                // å‡å°‘æŠ€èƒ½å†·å´æ—¶é—´
                reduceCooldown();
                
                // æ›´æ–°UI
                renderBoard();
                updateUI();
                
                // å¦‚æœè½®åˆ°AIä¸‹æ£‹ï¼Œåˆ™ç»§ç»­
                if (gameState.aiEnabled && gameState.aiPlayer === gameState.currentPlayer) {
                    setTimeout(makeAIMove, 1000);
                }
                return;
            }
            
            // è®¡ç®—æœ€ä½³è½å­ä½ç½®
            const move = calculateBestMove();
            
            if (move) {
                // æ‰§è¡Œè½å­
                placePiece(move.row, move.col);
            }
        }

        // æ¸²æŸ“æ£‹ç›˜
        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                const rowElement = document.createElement('div');
                rowElement.className = 'board-row';
                
                for (let j = 0; j < 15; j++) {
                    const cellElement = document.createElement('div');
                    cellElement.className = 'board-cell';
                    cellElement.dataset.row = i;
                    cellElement.dataset.col = j;
                    
                    // æ·»åŠ æ£‹å­
                    if (gameState.board[i][j] !== null) {
                        const pieceElement = document.createElement('div');
                        pieceElement.className = `piece ${gameState.board[i][j] === 0 ? 'black-piece' : 'white-piece'} ${gameState.lastMove && gameState.lastMove.row === i && gameState.lastMove.col === j ? 'last-move' : ''}`;
                        cellElement.appendChild(pieceElement);
                    }
                    
                    cellElement.addEventListener('click', () => placePiece(i, j));
                    rowElement.appendChild(cellElement);
                }
                
                boardElement.appendChild(rowElement);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°å½“å‰ç©å®¶æ˜¾ç¤º
            document.getElementById('currentPlayerText').textContent = 
                gameState.currentPlayer === 0 ? 'é»‘å­' : 'ç™½å­';
            
            // æ›´æ–°æŠ€èƒ½å†·å´æ—¶é—´
            for (let i = 0; i < 3; i++) {
                const skill = gameState.skills[i];
                const cooldownElement = document.getElementById(`cooldown${i}`);
                const skillBtn = document.getElementById(`skill${i}`);
                
                if (skill.currentCooldown > 0) {
                    cooldownElement.textContent = skill.currentCooldown;
                    cooldownElement.classList.remove('hidden');
                    skillBtn.disabled = true;
                } else {
                    cooldownElement.classList.add('hidden');
                    skillBtn.disabled = false;
                }
            }
        }

        // ç©å®¶é€‰æ‹©çŸ³å¤´å‰ªå­å¸ƒ
        function selectRPS(choice) {
            const choices = ['çŸ³å¤´', 'å‰ªåˆ€', 'å¸ƒ'];
            const computerChoice = choices[Math.floor(Math.random() * 3)];
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('playerChoice').textContent = choice;
            document.getElementById('computerChoice').textContent = computerChoice;
            
            // åˆ¤æ–­èƒœè´Ÿ
            let result = '';
            if (choice === computerChoice) {
                result = 'å¹³å±€';
            } else if (
                (choice === 'çŸ³å¤´' && computerChoice === 'å‰ªåˆ€') ||
                (choice === 'å‰ªåˆ€' && computerChoice === 'å¸ƒ') ||
                (choice === 'å¸ƒ' && computerChoice === 'çŸ³å¤´')
            ) {
                result = 'ä½ èµ¢äº†ï¼Œå…ˆæ‰‹';
                gameState.currentPlayer = 0;
                // å¦‚æœå¯ç”¨AIï¼Œåˆ™AIä¸ºç™½å­(åæ‰‹)
                if (gameState.aiEnabled) {
                    gameState.aiPlayer = 1;
                }
            } else {
                result = 'ç”µè„‘èµ¢äº†ï¼Œåæ‰‹';
                gameState.currentPlayer = 1;
                // å¦‚æœå¯ç”¨AIï¼Œåˆ™AIä¸ºé»‘å­(å…ˆæ‰‹)
                if (gameState.aiEnabled) {
                    gameState.aiPlayer = 0;
                }
            }
            
            document.getElementById('resultText').textContent = result;
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('rpsContainer').classList.add('hidden');
            document.getElementById('rpsResult').classList.remove('hidden');
            
            // 2ç§’åå¼€å§‹æ¸¸æˆ
            setTimeout(() => {
                document.getElementById('rpsResult').classList.add('hidden');
                document.getElementById('gameBoard').classList.remove('hidden');
                gameState.gameStatus = 'playing';
                updateUI();
                
                // å¦‚æœå¯ç”¨AIä¸”AIæ˜¯å…ˆæ‰‹ï¼Œåˆ™è®©AIä¸‹ç¬¬ä¸€æ­¥
                if (gameState.aiEnabled && gameState.aiPlayer === gameState.currentPlayer) {
                    setTimeout(makeAIMove, 1000);
                }
            }, 2000);
        }

        // è½å­
        function placePiece(row, col) {
            if (gameState.gameStatus !== 'playing' || gameState.board[row][col] !== null) return;
            
            // æ›´æ–°æ£‹ç›˜çŠ¶æ€
            gameState.board[row][col] = gameState.currentPlayer;
            gameState.lastMove = { row, col };
            gameState.moveHistory.push({ row, col, player: gameState.currentPlayer });
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            if (checkWin(row, col, gameState.currentPlayer)) {
                endGame(gameState.currentPlayer);
                return;
            }
            
            // åˆ‡æ¢ç©å®¶
            gameState.currentPlayer = 1 - gameState.currentPlayer;
            
            // å‡å°‘æŠ€èƒ½å†·å´æ—¶é—´
            reduceCooldown();
            
            // æ›´æ–°UI
            renderBoard();
            updateUI();
            
            // å¦‚æœå¯ç”¨AIä¸”è½®åˆ°AIä¸‹æ£‹ï¼Œåˆ™è®©AIä¸‹æ£‹
            if (gameState.aiEnabled && gameState.aiPlayer === gameState.currentPlayer) {
                setTimeout(makeAIMove, 1000);
            }
        }

        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin(row, col, player) {
            const directions = [
                [0, 1],  // æ°´å¹³
                [1, 0],  // å‚ç›´
                [1, 1],  // å¯¹è§’çº¿
                [1, -1]  // åå¯¹è§’çº¿
            ];
            
            for (let [dx, dy] of directions) {
                let count = 1; // åŒ…å«å½“å‰æ£‹å­
                
                // æ­£æ–¹å‘æ£€æŸ¥
                for (let i = 1; i <= 4; i++) {
                    const newRow = row + dx * i;
                    const newCol = col + dy * i;
                    if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                        gameState.board[newRow][newCol] === player) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                // åæ–¹å‘æ£€æŸ¥
                for (let i = 1; i <= 4; i++) {
                    const newRow = row - dx * i;
                    const newCol = col - dy * i;
                    if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15 && 
                        gameState.board[newRow][newCol] === player) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                if (count >= 5) return true;
            }
            
            return false;
        }

        // ç»“æŸæ¸¸æˆ
        function endGame(winner) {
            gameState.gameStatus = 'ended';
            gameState.winner = winner;
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
            document.getElementById('winnerText').textContent = 
                (winner === 0 ? 'é»‘å­' : 'ç™½å­') + 'è·èƒœ!';
            document.getElementById('gameOver').classList.remove('hidden');
        }

        // ä½¿ç”¨æŠ€èƒ½
        function useSkill(index) {
            if (gameState.gameStatus !== 'playing') return;
            
            const skill = gameState.skills[index];
            
            // æ£€æŸ¥å†·å´æ—¶é—´
            if (skill.currentCooldown > 0) {
                alert(`æŠ€èƒ½å†·å´ä¸­ï¼Œè¿˜éœ€${skill.currentCooldown}å›åˆ`);
                return;
            }
            
            switch(index) {
                case 0: // é£æ²™èµ°çŸ³
                    useFeisha();
                    break;
                case 1: // åŠ›æ‹”å±±å…®
                    useLiba();
                    break;
                case 2: // ä¸œå±±å†èµ·
                    useDongshan();
                    break;
            }
            
            // è®¾ç½®å†·å´æ—¶é—´
            gameState.skills[index].currentCooldown = skill.cooldown;
            
            // æ›´æ–°UI
            renderBoard();
            updateUI();
        }

        // é£æ²™èµ°çŸ³æŠ€èƒ½
        function useFeisha() {
            alert('é£æ²™èµ°çŸ³ï¼šç‚¹å‡»å¯¹æ–¹æ£‹å­ç§»é™¤');
            // æ·»åŠ é€‰æ‹©å¯¹æ–¹æ£‹å­çš„é€»è¾‘
            const boardElement = document.getElementById('board');
            boardElement.classList.add('selecting-target');
            
            // ä¸ºæ‰€æœ‰å¯¹æ‰‹æ£‹å­æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.piece').forEach(piece => {
                const cell = piece.parentElement;
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const pieceType = piece.classList.contains('black-piece') ? 0 : 1;
                
                // åªèƒ½é€‰æ‹©å¯¹æ‰‹çš„æ£‹å­
                if (pieceType !== gameState.currentPlayer) {
                    piece.classList.add('targetable');
                    piece.addEventListener('click', function removeTarget() {
                        // ç§»é™¤æ£‹å­
                        gameState.board[row][col] = null;
                        
                        // æ›´æ–°UI
                        renderBoard();
                        updateUI();
                        
                        // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨å’Œæ ·å¼
                        piece.classList.remove('targetable');
                        piece.removeEventListener('click', removeTarget);
                        boardElement.classList.remove('selecting-target');
                    });
                }
            });
        }

        // åŠ›æ‹”å±±å…®æŠ€èƒ½
        function useLiba() {
            // å®šä¹‰ä¸­å¿ƒåŒºåŸŸ(7x7)
            const centerStart = 4;
            const centerEnd = 10;
            
            for (let i = centerStart; i <= centerEnd; i++) {
                for (let j = centerStart; j <= centerEnd; j++) {
                    if (gameState.board[i][j] !== null) {
                        // ä¿å­˜è¢«ç§»é™¤çš„æ£‹å­
                        gameState.removedPieces.push({
                            row: i,
                            col: j,
                            piece: gameState.board[i][j]
                        });
                        
                        // ç§»é™¤æ£‹å­
                        gameState.board[i][j] = null;
                    }
                }
            }
            
            alert('åŠ›æ‹”å±±å…®ï¼šå·²æ¸…é™¤ä¸­å¿ƒåŒºåŸŸæ£‹å­');
        }

        // ä¸œå±±å†èµ·æŠ€èƒ½
        function useDongshan() {
            if (gameState.removedPieces.length === 0) {
                alert('æ²¡æœ‰å¯æ¢å¤çš„æ£‹å­');
                return;
            }
            
            // æ¢å¤æœ€åç§»é™¤çš„æ£‹å­
            const lastRemoved = gameState.removedPieces.pop();
            gameState.board[lastRemoved.row][lastRemoved.col] = lastRemoved.piece;
            
            alert('ä¸œå±±å†èµ·ï¼šå·²æ¢å¤1é¢—æ£‹å­');
        }

        // å‡å°‘æŠ€èƒ½å†·å´æ—¶é—´
        function reduceCooldown() {
            gameState.skills.forEach(skill => {
                if (skill.currentCooldown > 0) {
                    skill.currentCooldown--;
                }
            });
        }

        // æ‚”æ£‹
        function undoMove() {
            if (gameState.moveHistory.length === 0 || gameState.gameStatus !== 'playing') return;
            
            const lastMove = gameState.moveHistory.pop();
            gameState.board[lastMove.row][lastMove.col] = null;
            gameState.currentPlayer = lastMove.player;
            gameState.lastMove = gameState.moveHistory.length > 0 ? 
                gameState.moveHistory[gameState.moveHistory.length - 1] : null;
            
            // æ¢å¤æŠ€èƒ½å†·å´æ—¶é—´
            gameState.skills.forEach(skill => {
                if (skill.currentCooldown < skill.cooldown) {
                    skill.currentCooldown++;
                }
            });
            
            // æ›´æ–°UI
            renderBoard();
            updateUI();
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', () => {
            // çŸ³å¤´å‰ªå­å¸ƒæŒ‰é’®
            document.querySelectorAll('.rps-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectRPS(btn.dataset.choice);
                });
            });
            
            // æŠ€èƒ½æŒ‰é’®
            document.querySelectorAll('.skill-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    useSkill(parseInt(btn.dataset.index));
                });
            });
            
            // AIéš¾åº¦é€‰æ‹©
            document.getElementById('difficultySelect').addEventListener('change', (e) => {
                gameState.aiDifficulty = parseInt(e.target.value);
            });
            
            // å…¶ä»–æŒ‰é’®
            document.getElementById('undoBtn').addEventListener('click', undoMove);
            document.getElementById('restartBtn').addEventListener('click', initGame);
            document.getElementById('playAgainBtn').addEventListener('click', initGame);
            document.getElementById('homeBtn').addEventListener('click', () => {
                document.getElementById('gameOver').classList.add('hidden');
                document.getElementById('rpsContainer').classList.remove('hidden');
                initGame();
            });
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        });
    </script>
</body>
</html>